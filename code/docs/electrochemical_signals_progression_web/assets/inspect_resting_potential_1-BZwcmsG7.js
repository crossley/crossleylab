var Te=Object.defineProperty;var Ye=(e,n,d)=>n in e?Te(e,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[n]=d;var le=(e,n,d)=>Ye(e,typeof n!="symbol"?n+"":n,d);import"./style-WLU6Igt5.js";class _e{constructor(n){le(this,"state");le(this,"spare",null);this.state=n>>>0||1}next(){let n=this.state;return n^=n<<13,n^=n>>>17,n^=n<<5,this.state=n>>>0,this.state/4294967296}uniform(n,d){return n+(d-n)*this.next()}normal(n=0,d=1){if(this.spare!==null){const t=this.spare;return this.spare=null,n+d*t}let f=0,a=0;for(;f<=Number.EPSILON;)f=this.next();for(;a<=Number.EPSILON;)a=this.next();const m=Math.sqrt(-2*Math.log(f)),c=m*Math.cos(2*Math.PI*a),u=m*Math.sin(2*Math.PI*a);return this.spare=u,n+d*c}}const S={T:2400,dt:1,numParticles:140,boxWidth:200,boxHeight:200,wallThickness:4,diffusionSd:.1,electricStrength:.1,electricStrengthDepol:.2,repulsionStrength:.05,channelYMin:-10,channelYMax:10,negX:-80,negY:0,initialLeftFrac:.65,depolStartFrac:1/3,depolEndFrac:2/3},A={pointSize:2.2,playbackSpeed:1,targetFps:30,traceYLimit:120};function l(e,n,d){return Math.min(d,Math.max(n,e))}function oe(){return Math.random()*4294967295>>>0}function o(e){const n=document.querySelector(e);if(!n)throw new Error(`Missing ${e}`);return n}function p(e,n,d=3){e.value=Number.isInteger(n)?String(n):Number(n.toFixed(d)).toString()}function Le(e,n,d){const f=d/2,a=l(Math.min(e,n),-f,f),m=l(Math.max(e,n),-f,f);return m-a<.5?[a,Math.min(f,a+.5)]:[a,m]}function me(e,n){const d=l(Math.round(e.T),50,2e4),f=l(e.dt,.05,20),a=l(Math.round(e.numParticles),10,300),m=l(e.boxWidth,40,500),c=l(e.boxHeight,40,500),u=l(e.wallThickness,.5,Math.min(50,m-2)),t=l(e.diffusionSd,0,20),g=l(e.electricStrength,0,10),T=l(e.electricStrengthDepol,0,10),Y=l(e.repulsionStrength,0,10),[D,_]=Le(e.channelYMin,e.channelYMax,c),M=-u/2,P=u/2,z=l(e.negX,-m/2,m/2),L=l(e.negY,-c/2,c/2),v=l(e.initialLeftFrac,0,1),s=Math.max(2,Math.floor(d/f)),y=l(Math.floor(s*l(e.depolStartFrac,0,1)),0,s-1),F=l(Math.floor(s*l(e.depolEndFrac,0,1)),y,s-1),N=new Float32Array(s*a),R=new Float32Array(s*a),de=new Float32Array(s),ce=new Float32Array(s),V=new _e(n);for(let x=0;x<s;x+=1)de[x]=x*f;const Me=Math.floor(a*v);for(let x=0;x<a;x+=1){const C=x<Me;N[x]=C?V.uniform(-m/2+1,M-1):V.uniform(P+1,m/2-1),R[x]=V.uniform(D-5,_+5)}const ee=new Float32Array(a),te=new Float32Array(a);for(let x=1;x<s;x+=1){const C=(x-1)*a,ne=x*a;ee.fill(0),te.fill(0);for(let b=0;b<a;b+=1){const w=N[C+b],H=R[C+b];let $=0,G=0;for(let W=0;W<a;W+=1){if(W===b)continue;const X=w-N[C+W],q=H-R[C+W],O=1/(X*X+q*q+.001);$+=X*O,G+=q*O}ee[b]=Y*$,te[b]=Y*G}for(let b=0;b<a;b+=1){const w=N[C+b],H=R[C+b],$=V.normal(0,t),G=V.normal(0,t),W=z-w,X=L-H,q=Math.sqrt(W*W+X*X)+.001,he=g*W/q,O=g*X/q;let fe=0,ge=0;if(x>=y&&x<=F){const ie=w-z,ae=H-L,be=Math.sqrt(ie*ie+ae*ae)+.001;fe=T*ie/be,ge=T*ae/be}let U=w+($+he+ee[b]+fe)*f;const we=l(H+(G+O+te[b]+ge)*f,-c/2,c/2),ke=w>P&&U<=P,Pe=w<M&&U>=M,Fe=H>=D&&H<=_;(ke||Pe)&&!Fe&&(U=w),N[ne+b]=U,R[ne+b]=we}let pe=0,ue=0;for(let b=0;b<a;b+=1){const w=N[ne+b];w<M?pe+=1:w>P&&(ue+=1)}ce[x]=-(pe-ue)}return{x:N,y:R,frames:s,numParticles:a,dt:f,t:de,boxWidth:m,boxHeight:c,leftWall:M,rightWall:P,channelYMin:D,channelYMax:_,negX:z,negY:L,depolStart:y,depolEnd:F,V:ce}}function Ne(e,n,d,f){const a=window.devicePixelRatio||1,m=e.getBoundingClientRect(),c=Math.max(1,Math.round(m.width*a)),u=Math.max(1,Math.round(m.height*a));(e.width!==c||e.height!==u)&&(e.width=c,e.height=u);const t=e.getContext("2d");if(!t)return;t.clearRect(0,0,c,u),t.fillStyle="#03060b",t.fillRect(0,0,c,u),t.strokeStyle="rgba(120,170,255,0.10)",t.lineWidth=1;for(let s=1;s<10;s+=1){const y=c*s/10,F=u*s/10;t.beginPath(),t.moveTo(y,0),t.lineTo(y,u),t.stroke(),t.beginPath(),t.moveTo(0,F),t.lineTo(c,F),t.stroke()}const g=34*a,T=10*a,Y=18*a,D=18*a,_=c-g-T,M=u-Y-D,P=n.t[n.t.length-1]||1,z=s=>g+s/P*_,L=s=>Y+(1-(s+f)/(2*f))*M;t.strokeStyle="rgba(180,220,255,0.28)",t.lineWidth=1*a,t.strokeRect(g,Y,_,M),t.beginPath(),t.moveTo(g,L(0)),t.lineTo(g+_,L(0)),t.stroke(),t.strokeStyle="#c68dff",t.lineWidth=1.7*a,t.beginPath();const v=l(d,0,n.frames-1);for(let s=0;s<=v;s+=1){const y=z(n.t[s]),F=L(n.V[s]);s===0?t.moveTo(y,F):t.lineTo(y,F)}t.stroke(),t.fillStyle="rgba(232,243,255,0.92)",t.font=`${12*a}px Avenir Next, Segoe UI, sans-serif`,t.fillText("Membrane Potential Proxy",12*a,14*a)}function We(e,n,d,f){const a=window.devicePixelRatio||1,m=e.getBoundingClientRect(),c=Math.max(1,Math.round(m.width*a)),u=Math.max(1,Math.round(m.height*a));(e.width!==c||e.height!==u)&&(e.width=c,e.height=u);const t=e.getContext("2d");if(!t)return;t.clearRect(0,0,c,u),t.fillStyle="#03060b",t.fillRect(0,0,c,u),t.strokeStyle="rgba(120,170,255,0.10)",t.lineWidth=1;for(let v=1;v<10;v+=1){const s=c*v/10,y=u*v/10;t.beginPath(),t.moveTo(s,0),t.lineTo(s,u),t.stroke(),t.beginPath(),t.moveTo(0,y),t.lineTo(c,y),t.stroke()}const g=(v,s)=>[(v+n.boxWidth/2)/n.boxWidth*c,u-(s+n.boxHeight/2)/n.boxHeight*u],[T]=g(n.leftWall,0),[Y]=g(n.rightWall,0),[,D]=g(0,n.channelYMax),[,_]=g(0,n.channelYMin);t.fillStyle="rgba(200,220,255,0.08)",t.fillRect(T,0,Y-T,u),t.fillStyle="rgba(159,255,106,0.10)",t.fillRect(T,D,Y-T,_-D),t.strokeStyle="rgba(190,225,255,0.45)",t.lineWidth=1.5*a;for(const v of[n.leftWall,n.rightWall]){const[s]=g(v,0),[,y]=g(0,n.boxHeight/2),[,F]=g(0,n.channelYMax),[,N]=g(0,n.channelYMin),[,R]=g(0,-n.boxHeight/2);t.beginPath(),t.moveTo(s,y),t.lineTo(s,F),t.moveTo(s,N),t.lineTo(s,R),t.stroke()}const[M,P]=g(n.negX,n.negY);t.fillStyle="rgba(255,96,96,0.95)",t.beginPath(),t.arc(M,P,4*a,0,Math.PI*2),t.fill(),d>=n.depolStart&&d<=n.depolEnd&&(t.fillStyle="rgba(114,255,178,0.95)",t.beginPath(),t.arc(M,P,7*a,0,Math.PI*2),t.fill());const z=l(d,0,n.frames-1)*n.numParticles,L=Math.max(.8,f)*a;t.fillStyle="rgba(245,178,72,0.92)";for(let v=0;v<n.numParticles;v+=1){const[s,y]=g(n.x[z+v],n.y[z+v]);t.beginPath(),t.arc(s,y,L,0,Math.PI*2),t.fill()}t.fillStyle="rgba(232,243,255,0.92)",t.font=`${12*a}px Avenir Next, Segoe UI, sans-serif`,t.fillText("Ion Movement with Channel",12*a,14*a)}const Ee=o("#app");Ee.innerHTML=`
  <div class="site-shell">
    <div class="nav-line"><a href="./index.html">Back to index</a><span>•</span><span>Page: <code>inspect_resting_potential_1</code></span></div>
    <header class="page-head"><p class="eyebrow">Resting-Potential and Goldman-Style Extensions</p><h1>inspect_resting_potential_1</h1><p class="subtitle">Toy resting-potential simulation with a transient depolarizing input and a membrane-potential proxy trace.</p></header>
    <div class="sim-layout">
      <aside class="controls"><div class="panel">
        <div class="group"><p class="group-label">Basic Controls</p>
          <div class="button-row"><button id="toggle-play" class="primary">Pause</button><button id="rerun">Rerun</button><button id="reset-defaults" class="warn">Reset Defaults</button></div>
          <div class="button-row"><button id="rewind">Rewind</button><button id="random-seed">Randomize Seed</button></div>
          <div class="control-grid">
            <div class="field"><label for="num-particles">Particles</label><input id="num-particles" type="number" min="10" max="300" step="1" /></div>
            <div class="field"><label for="diffusion-sd">Diffusion SD</label><input id="diffusion-sd" type="number" min="0" max="20" step="0.01" /></div>
            <div class="field"><label for="electric-strength">Base electric strength</label><input id="electric-strength" type="number" min="0" max="10" step="0.01" /></div>
            <div class="field"><label for="electric-strength-depol">Depol strength</label><input id="electric-strength-depol" type="number" min="0" max="10" step="0.01" /></div>
            <div class="field"><label for="repulsion-strength">Repulsion strength</label><input id="repulsion-strength" type="number" min="0" max="10" step="0.01" /></div>
            <div class="field"><label for="channel-y-min">Channel y min</label><input id="channel-y-min" type="number" step="0.5" /></div>
            <div class="field"><label for="channel-y-max">Channel y max</label><input id="channel-y-max" type="number" step="0.5" /></div>
            <div class="field"><label for="playback-speed">Playback speed</label><input id="playback-speed" type="number" min="0.1" max="8" step="0.1" /></div>
            <div class="field"><label for="seed">Seed</label><input id="seed" type="number" min="0" max="4294967295" step="1" /></div>
          </div>
        </div>
        <details><summary>Advanced Controls</summary><div class="group" style="margin-top:8px;"><div class="control-grid">
          <div class="field"><label for="total-time">Total time T (ms)</label><input id="total-time" type="number" min="50" max="20000" step="10" /></div>
          <div class="field"><label for="dt">dt (ms)</label><input id="dt" type="number" min="0.05" max="20" step="0.05" /></div>
          <div class="field"><label for="box-width">Box width</label><input id="box-width" type="number" min="40" max="500" step="1" /></div>
          <div class="field"><label for="box-height">Box height</label><input id="box-height" type="number" min="40" max="500" step="1" /></div>
          <div class="field"><label for="wall-thickness">Wall thickness</label><input id="wall-thickness" type="number" min="0.5" max="50" step="0.5" /></div>
          <div class="field"><label for="neg-x">Source x</label><input id="neg-x" type="number" step="1" /></div>
          <div class="field"><label for="neg-y">Source y</label><input id="neg-y" type="number" step="1" /></div>
          <div class="field"><label for="initial-left-frac">Initial left fraction</label><input id="initial-left-frac" type="number" min="0" max="1" step="0.01" /></div>
          <div class="field"><label for="depol-start-frac">Depol start frac</label><input id="depol-start-frac" type="number" min="0" max="1" step="0.01" /></div>
          <div class="field"><label for="depol-end-frac">Depol end frac</label><input id="depol-end-frac" type="number" min="0" max="1" step="0.01" /></div>
          <div class="field"><label for="trace-ylim">Trace y-limit</label><input id="trace-ylim" type="number" min="10" max="500" step="1" /></div>
          <div class="field"><label for="point-size">Point size</label><input id="point-size" type="number" min="0.5" max="8" step="0.25" /></div>
          <div class="field"><label for="target-fps">Playback FPS</label><input id="target-fps" type="number" min="1" max="120" step="1" /></div>
        </div></div></details>
        <div class="group"><p class="group-label">Status</p><dl class="status-list">
          <dt>Frame</dt><dd id="status-frame">0</dd><dt>Time (ms)</dt><dd id="status-time">0.0</dd>
          <dt>V proxy</dt><dd id="status-v">0</dd><dt>dt</dt><dd id="status-dt">0</dd>
          <dt>Step SD</dt><dd id="status-step-sd">0</dd><dt>Seed</dt><dd id="status-seed">0</dd>
        </dl></div>
        <div class="group"><p class="group-label">Equation + Transient Depolarization</p><div class="equation-card"><pre class="equation" id="equation-block"></pre><p>Middle-run depolarizing input is modeled as a temporary repulsive source at the same position as the negative source.</p></div></div>
      </div></aside>
      <section class="panel canvas-panel">
        <div class="canvas-head"><h2>Resting-Potential Toy Model With Transient Depolarization</h2><span class="tiny">Qualitative browser port of <code>inspect_resting_potential_1.py</code></span></div>
        <div class="canvas-grid-2">
          <div class="canvas-subpanel"><div class="subhead"><h3>Particle Dynamics</h3><span class="tiny">Green marker appears during depolarizing input window</span></div><canvas id="particle-canvas"></canvas></div>
          <div class="canvas-subpanel"><div class="subhead"><h3>Membrane Potential Proxy</h3><span class="tiny">V = -(#left - #right)</span></div><canvas id="trace-canvas"></canvas></div>
        </div>
        <div class="legend"><span><span class="swatch" style="background:#f5b248"></span>Particles</span><span><span class="swatch" style="background:#ff6060"></span>Negative source</span><span><span class="swatch" style="background:#72ffb2"></span>Depolarizing source (active window)</span></div>
      </section>
    </div>
  </div>
`;const De=o("#particle-canvas"),ze=o("#trace-canvas"),Re=o("#equation-block"),i={numParticles:o("#num-particles"),diffusionSd:o("#diffusion-sd"),electricStrength:o("#electric-strength"),electricStrengthDepol:o("#electric-strength-depol"),repulsionStrength:o("#repulsion-strength"),channelYMin:o("#channel-y-min"),channelYMax:o("#channel-y-max"),playbackSpeed:o("#playback-speed"),seed:o("#seed"),totalTime:o("#total-time"),dt:o("#dt"),boxWidth:o("#box-width"),boxHeight:o("#box-height"),wallThickness:o("#wall-thickness"),negX:o("#neg-x"),negY:o("#neg-y"),initialLeftFrac:o("#initial-left-frac"),depolStartFrac:o("#depol-start-frac"),depolEndFrac:o("#depol-end-frac"),traceYLim:o("#trace-ylim"),pointSize:o("#point-size"),targetFps:o("#target-fps")},B={frame:o("#status-frame"),time:o("#status-time"),v:o("#status-v"),dt:o("#status-dt"),stepSd:o("#status-step-sd"),seed:o("#status-seed")},j={togglePlay:o("#toggle-play"),rerun:o("#rerun"),resetDefaults:o("#reset-defaults"),rewind:o("#rewind"),randomSeed:o("#random-seed")};let r={...S},k={...A},E=oe(),h=me(r,E),Q=!0,I=0,se=performance.now();function J(){p(i.numParticles,r.numParticles,0),p(i.diffusionSd,r.diffusionSd,3),p(i.electricStrength,r.electricStrength,3),p(i.electricStrengthDepol,r.electricStrengthDepol,3),p(i.repulsionStrength,r.repulsionStrength,3),p(i.channelYMin,r.channelYMin,2),p(i.channelYMax,r.channelYMax,2),p(i.playbackSpeed,k.playbackSpeed,2),p(i.seed,E,0),p(i.totalTime,r.T,0),p(i.dt,r.dt,3),p(i.boxWidth,r.boxWidth,1),p(i.boxHeight,r.boxHeight,1),p(i.wallThickness,r.wallThickness,2),p(i.negX,r.negX,1),p(i.negY,r.negY,1),p(i.initialLeftFrac,r.initialLeftFrac,2),p(i.depolStartFrac,r.depolStartFrac,2),p(i.depolEndFrac,r.depolEndFrac,2),p(i.traceYLim,k.traceYLimit,0),p(i.pointSize,k.pointSize,2),p(i.targetFps,k.targetFps,0)}function Ce(){const e=l(Number(i.boxHeight.value)||S.boxHeight,40,500),n=l(Number(i.boxWidth.value)||S.boxWidth,40,500);return{T:l(Number(i.totalTime.value)||S.T,50,2e4),dt:l(Number(i.dt.value)||S.dt,.05,20),numParticles:l(Math.round(Number(i.numParticles.value)||S.numParticles),10,300),boxWidth:n,boxHeight:e,wallThickness:l(Number(i.wallThickness.value)||S.wallThickness,.5,50),diffusionSd:l(Number(i.diffusionSd.value)||0,0,20),electricStrength:l(Number(i.electricStrength.value)||0,0,10),electricStrengthDepol:l(Number(i.electricStrengthDepol.value)||0,0,10),repulsionStrength:l(Number(i.repulsionStrength.value)||0,0,10),channelYMin:l(Number(i.channelYMin.value)||0,-e/2,e/2),channelYMax:l(Number(i.channelYMax.value)||0,-e/2,e/2),negX:l(Number(i.negX.value)||S.negX,-n/2,n/2),negY:l(Number(i.negY.value)||S.negY,-e/2,e/2),initialLeftFrac:l(Number(i.initialLeftFrac.value)||S.initialLeftFrac,0,1),depolStartFrac:l(Number(i.depolStartFrac.value)||S.depolStartFrac,0,1),depolEndFrac:l(Number(i.depolEndFrac.value)||S.depolEndFrac,0,1)}}function xe(){return{pointSize:l(Number(i.pointSize.value)||A.pointSize,.5,8),playbackSpeed:l(Number(i.playbackSpeed.value)||A.playbackSpeed,.1,8),targetFps:l(Math.round(Number(i.targetFps.value)||A.targetFps),1,120),traceYLimit:l(Number(i.traceYLim.value)||A.traceYLimit,10,500)}}function ve(){const e=r.diffusionSd*r.dt;Re.innerHTML=['<span class="accent">Euler update with base attraction + repulsion + transient depolarizing input</span>',"attract = electric_strength · (neg_pos - pos) / (||neg_pos - pos|| + ε)","repel = repulsion_strength · Σ_k≠j (pos_j - pos_k) / (||pos_j - pos_k||² + ε)","During depolarizing window: depol_force = electric_strength_depol · (pos - depol_pos) / (||pos - depol_pos|| + ε)","x_new = x_old + (dxdt + attract_x + repel_x + depol_x) · dt","y_new = clamp(y_old + (dydt + attract_y + repel_y + depol_y) · dt, -H/2, H/2)","dxdt, dydt ~ Normal(0, diffusionSd²)","",'<span class="accent-2">Membrane rule + voltage proxy</span>',"Wall crossing only if y_old ∈ [channel_y_min, channel_y_max] ; else x_new := x_old","V_proxy = -(#left - #right)",`Per-step Brownian displacement SD = diffusionSd × dt = ${e.toFixed(3)}`].join(`
`)}function re(e){B.frame.textContent=`${e+1}`,B.time.textContent=h.t[e].toFixed(1),B.v.textContent=h.V[e].toFixed(0),B.dt.textContent=h.dt.toFixed(2),B.stepSd.textContent=(r.diffusionSd*r.dt).toFixed(3),B.seed.textContent=`${E>>>0}`}function K(e){We(De,h,e,k.pointSize),Ne(ze,h,e,k.traceYLimit)}function Z(e=!0){r=Ce(),k=xe(),E=l(Math.floor(Number(i.seed.value)||E),0,4294967295)>>>0,h=me(r,E),r={...r,boxWidth:h.boxWidth,boxHeight:h.boxHeight,wallThickness:h.rightWall-h.leftWall,channelYMin:h.channelYMin,channelYMax:h.channelYMax,negX:h.negX,negY:h.negY,depolStartFrac:h.depolStart/Math.max(1,h.frames-1),depolEndFrac:h.depolEnd/Math.max(1,h.frames-1)},e&&(I=0),J(),ve()}function He(){k=xe(),J()}function ye(e){Q=e,j.togglePlay.textContent=Q?"Pause":"Play"}J();ve();re(0);K(0);j.togglePlay.addEventListener("click",()=>ye(!Q));j.rerun.addEventListener("click",()=>Z(!0));j.rewind.addEventListener("click",()=>{I=0,re(0),K(0)});j.randomSeed.addEventListener("click",()=>{E=oe(),p(i.seed,E,0),Z(!0)});j.resetDefaults.addEventListener("click",()=>{r={...S},k={...A},E=oe(),J(),Z(!0),ye(!0)});const Xe=[i.numParticles,i.diffusionSd,i.electricStrength,i.electricStrengthDepol,i.repulsionStrength,i.channelYMin,i.channelYMax,i.seed,i.totalTime,i.dt,i.boxWidth,i.boxHeight,i.wallThickness,i.negX,i.negY,i.initialLeftFrac,i.depolStartFrac,i.depolEndFrac];for(const e of Xe)e.addEventListener("change",()=>Z(e!==i.seed));for(const e of[i.playbackSpeed,i.traceYLim,i.pointSize,i.targetFps])e.addEventListener("change",()=>He());window.addEventListener("resize",()=>K(Math.floor(I)));function Se(e){const n=(e-se)/1e3;se=e,Q&&h.frames>0&&(I+=n*k.targetFps*k.playbackSpeed,I>=h.frames&&(I%=h.frames));const d=l(Math.floor(I),0,Math.max(0,h.frames-1));re(d),K(d),requestAnimationFrame(Se)}requestAnimationFrame(e=>{se=e,Se(e)});
